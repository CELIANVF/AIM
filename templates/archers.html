{% extends "layout.html" %}

{% block title %}Archers{% endblock %}

{% block content %}
<div class="header-with-actions">
    <div>
        <h1>ğŸ‘¥ Archers</h1>
        <p class="muted">{{ archers|length }} archer(s) enregistrÃ©(s)</p>
    </div>
    <div class="action-group">
        {% if current_user.can_edit() %}
        <a class="btn btn-primary" href="/add_archer">â• Ajouter un archer</a>
        <a class="btn btn-outline" href="/import_archers">ğŸ“¥ Importer CSV</a>
        {% endif %}
        <a class="btn btn-outline" href="/export_archers">ğŸ“„ Exporter PDF</a>
    </div>
</div>

<div style="margin-bottom: 20px; padding: 16px; background-color: #f9f9f9; border-radius: 8px; border: 1px solid #ddd;">
    <label style="font-weight: bold; margin-bottom: 8px; display: block;">ğŸ“Š Trier par:</label>
    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
        <form method="GET" action="/archers" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin: 0;">
            <select name="sort_by" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; background-color: white; cursor: pointer;">
                <option value="nom" {% if current_sort.by == 'nom' %}selected{% endif %}>Nom</option>
                <option value="prenom" {% if current_sort.by == 'prenom' %}selected{% endif %}>PrÃ©nom</option>
                <option value="age" {% if current_sort.by == 'age' %}selected{% endif %}>Ã‚ge</option>
                <option value="licence" {% if current_sort.by == 'licence' %}selected{% endif %}>NumÃ©ro de licence</option>
                <option value="categorie" {% if current_sort.by == 'categorie' %}selected{% endif %}>CatÃ©gorie</option>
                <option value="arc" {% if current_sort.by == 'arc' %}selected{% endif %}>Arc assignÃ©</option>
            </select>
            
            <select name="sort_order" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; background-color: white; cursor: pointer;">
                <option value="asc" {% if current_sort.order == 'asc' %}selected{% endif %}>â†‘ Croissant</option>
                <option value="desc" {% if current_sort.order == 'desc' %}selected{% endif %}>â†“ DÃ©croissant</option>
            </select>
            
            <a href="/archers" class="btn btn-outline" style="padding: 8px 12px; font-size: 14px;">â†» RÃ©initialiser</a>
        </form>
    </div>
</div>

<div class="grid">
    {% for a in archers %}
    <div class="item">
        <div style="display:flex;flex-direction:column;gap:12px">
            <div>
                <h3 style="margin:0 0 8px 0">{{ (a.first_name + ' ' if a.first_name else '') + (a.last_name or '') or 'Sans nom' }}</h3>
                <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap">
                    {% if a.age %}
                        <span class="badge badge-primary">ğŸ‚ {{ a.age }} ans</span>
                    {% endif %}
                    {% if a.license_number %}
                        <span class="badge badge-success">ğŸ« {{ a.license_number }}</span>
                    {% endif %}
                    {% if a.categorie %}
                        <span class="badge" style="background-color: #e3f2fd; color: #1976d2;">ğŸ“Œ {{ a.categorie }}</span>
                    {% endif %}
                </div>
                {% if a.bow_type or a.bow_length or a.draw_length %}
                <div style="padding-top:8px;border-top:1px solid var(--border-light)">
                    {% if a.bow_type %}
                        <p class="small" style="margin:4px 0"><strong>Type d'arc:</strong> {{ a.bow_type }}</p>
                    {% endif %}
                    {% if a.bow_length %}
                        <p class="small" style="margin:4px 0"><strong>Longueur:</strong> {{ a.bow_length }}</p>
                    {% endif %}
                    {% if a.draw_length %}
                        <p class="small" style="margin:4px 0"><strong>Tirage:</strong> {{ a.draw_length }}</p>
                    {% endif %}
                    {% if a.current_assignment %}
                        <p class="small" style="margin:4px 0"><strong>Arc assignÃ©:</strong> <span class="badge badge-success">{{ a.current_assignment.composite.name }}</span></p>
                    {% else %}
                        <p class="small" style="margin:4px 0"><strong>Arc assignÃ©:</strong> <span class="muted">Aucun</span></p>
                    {% endif %}
                </div>
                {% else %}
                <div style="padding-top:8px;border-top:1px solid var(--border-light)">
                    {% if a.current_assignment %}
                        <p class="small" style="margin:4px 0"><strong>Arc assignÃ©:</strong> <span class="badge badge-success">{{ a.current_assignment.composite.name }}</span></p>
                    {% else %}
                        <p class="small" style="margin:4px 0"><strong>Arc assignÃ©:</strong> <span class="muted">Aucun</span></p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            <div style="padding-top:8px;border-top:1px solid var(--border-light)">
                <div style="display:flex;gap:8px;flex-wrap:wrap">
                    {% if current_user.can_edit() %}
                    <a class="btn btn-outline" href="/edit_archer/{{ a.id }}" style="flex:1">âœï¸ Modifier</a>
                    {% if a.current_assignment %}
                    <form method="POST" action="/return/{{ a.current_assignment.id }}" style="flex:1" onsubmit="return confirm('Retourner l\'arc {{ a.current_assignment.composite.name }} ?');">
                        <button type="submit" class="btn btn-warning" style="width:100%;cursor:pointer">â†©ï¸ Retourner arc</button>
                    </form>
                    {% else %}
                    <a class="btn btn-success" href="/assign?archer_id={{ a.id }}" style="flex:1;text-align:center">ğŸ¯ Assigner arc</a>
                    {% endif %}
                    {% endif %}
                    {% if current_user.can_delete() %}
                    <form method="POST" action="/delete_archer/{{ a.id }}" style="flex:1" onsubmit="return confirm('âš ï¸ ÃŠtes-vous sÃ»r de vouloir supprimer cet archer ? Cette action est irrÃ©versible.');">
                        <button type="submit" class="btn btn-danger" style="width:100%;cursor:pointer">ğŸ—‘ï¸ Supprimer</button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="card" style="grid-column:1/-1;text-align:center;padding:48px 24px">
        <p class="muted">Aucun archer enregistrÃ© pour le moment</p>
        {% if current_user.can_edit() %}
        <a href="/add_archer" class="btn btn-primary" style="margin-top:16px">â• Ajouter le premier archer</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}