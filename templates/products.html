{% extends "layout.html" %}

{% block title %}Produits{% endblock %}

{% block content %}
<div class="header-with-actions">
    <div>
        <h1>ğŸ“¦ Produits unitaires</h1>
        <p class="muted">{{ products|length }} produit(s) au total</p>
    </div>
    <div class="action-group">
        {% if current_user.can_edit() %}
        <a class="btn btn-primary" href="/add_product">â• Ajouter un produit</a>
        {% endif %}
        <a class="btn btn-outline" href="/export_products">ğŸ“„ Exporter PDF</a>
    </div>
</div>

<div class="grid">
    {% for p in products %}
    <div class="item">
        <div style="display:flex;flex-direction:column;gap:12px">
            <div>
                <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
                    <h3 style="margin:0">{{ p.brand }}</h3>
                    <span class="badge badge-primary">{{ p.category.name }}</span>
                </div>
                <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
                    {% if p.state == 'stock' %}
                        <span class="badge badge-success">âœ“ Disponible</span>
                    {% elif p.state == 'broken' %}
                        <span class="badge badge-danger">âœ— CassÃ©</span>
                    {% endif %}
                </div>
                {% if p.custom_values %}
                <div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border-light)">
                    {% for k, v in p.custom_values.items() %}
                        <span class="small" style="margin-right:12px"><strong>{{ k }}:</strong> {{ v }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                {% if p.comments %}
                <p class="small muted" style="margin-top:8px">ğŸ’¬ {{ p.comments }}</p>
                {% endif %}
            </div>
            <div class="action-group" style="padding-top:8px;border-top:1px solid var(--border-light)">
                {% if current_user.can_edit() %}
                <a class="btn btn-outline" href="/edit_product/{{ p.id }}" style="flex:1">âœï¸ Modifier</a>
                <a class="btn btn-secondary" href="/duplicate_product/{{ p.id }}" style="flex:1">ğŸ“‹ Dupliquer</a>
                {% endif %}
                {% if current_user.can_delete() %}
                <form method="POST" action="/delete_product/{{ p.id }}" style="flex:1" onsubmit="return confirm('âš ï¸ ÃŠtes-vous sÃ»r de vouloir supprimer ce produit ? Cette action est irrÃ©versible.');">
                    <button type="submit" class="btn btn-danger" style="width:100%;cursor:pointer;margin:0">ğŸ—‘ï¸ Supprimer</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="card" style="grid-column:1/-1;text-align:center;padding:48px 24px">
        <p class="muted">Aucun produit enregistrÃ© pour le moment</p>
        {% if current_user.can_edit() %}
        <a href="/add_product" class="btn btn-primary" style="margin-top:16px">â• Ajouter le premier produit</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}